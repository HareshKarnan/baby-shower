<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gayatri's Seemantham</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500&family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="page">
      <section class="invite">
        <!-- <p class="kicker">Paperless Post Flyer</p> -->
        <h1>Gayatri's Seemantham</h1>

        <div class="block">
          <p class="label">Hosted by</p>
          <p class="value">Gayatri and Haresh</p>
        </div>

        <div class="divider"></div>

        <div class="block">
          <p class="label">When</p>
          <p class="value">Saturday, February 21</p>
          <p class="value">11:30AM PST</p>
        </div>

        <div class="block">
          <p class="label">Where</p>
          <p class="value">Lounge @ Monticello</p>
          <p class="value">3485 Monroe St</p>
          <p class="value">Santa Clara, CA 95051</p>
        </div>

        <div class="divider"></div>

        <p class="message">
          With great joy, we look forward to welcoming our baby and warmly invite
          you to join us for the Seemantham (traditional baby shower) ceremony to
          celebrate this auspicious occasion.
        </p>

        <div class="rsvp-options" role="group" aria-label="RSVP response">
          <button class="rsvp-choice" type="button" data-attendance="yes">
            Will attend
          </button>
          <button class="rsvp-choice" type="button" data-attendance="no">
            Will not attend
          </button>
        </div>

        <form class="rsvp-form" id="rsvpForm">
          <input type="hidden" name="rsvp" id="rsvpResponse" />
          <label>
            Full name
            <input type="text" name="name" required />
          </label>
          <label class="attending-field" id="attendingField">
            Total attending
            <select name="attending">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </label>
          <label>
            Email (optional)
            <input type="email" name="email" />
          </label>
          <label>
            Phone (optional)
            <input type="tel" name="phone" />
          </label>
          <label>
            Notes (optional)
            <textarea name="notes" rows="3"></textarea>
          </label>
          <button class="rsvp-submit" type="submit">Send RSVP</button>
          <p class="form-status" id="formStatus" aria-live="polite"></p>
        </form>
      </section>

      <section class="art">
        <img src="assets/elephant.png" alt="A little peanut is on the way" />
      </section>
    </main>

    <script>
      const form = document.getElementById("rsvpForm");
      const status = document.getElementById("formStatus");
      const responseInput = document.getElementById("rsvpResponse");
      const attendingField = document.getElementById("attendingField");
      const attendingSelect = attendingField.querySelector("select");
      const choiceButtons = document.querySelectorAll(".rsvp-choice");

      const setAttendance = (value) => {
        responseInput.value = value === "yes" ? "Will attend" : "Will not attend";
        attendingField.classList.toggle("is-hidden", value !== "yes");
        attendingSelect.required = value === "yes";
        form.classList.add("is-visible");
        form.querySelector("input[name='name']").focus();
      };

      choiceButtons.forEach((button) => {
        button.addEventListener("click", () => {
          choiceButtons.forEach((btn) => btn.classList.remove("is-selected"));
          button.classList.add("is-selected");
          setAttendance(button.dataset.attendance);
        });
      });

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        status.textContent = "Sending...";

        const payload = new FormData(form);
        const endpoint = "https://script.google.com/macros/s/AKfycbyAsTE3WaQlmoCu7Xm-QdiZPHakwu2T65dOwQaS7NzeS9QGtHVK873FwXN0bT_RUo8PCg/exec";

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            body: payload,
          });

          if (!response.ok) {
            throw new Error("Request failed");
          }

          form.reset();
          choiceButtons.forEach((btn) => btn.classList.remove("is-selected"));
          attendingField.classList.add("is-hidden");
          attendingSelect.required = false;
          status.textContent = "Thank you! Your RSVP has been received.";
        } catch (error) {
          status.textContent =
            "Sorry, we could not submit your RSVP. Please try again.";
        }
      });
    </script>
  </body>
</html>
